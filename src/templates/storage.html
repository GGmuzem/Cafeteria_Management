<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Склад</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Склад продуктов</h1>
    <a href="/menu">Вернуться в меню</a>

    <!-- Вывод сообщений (flash) -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul style="color: blue;">
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
        </ul>
    {% endif %}
    {% endwith %}

    <!-- Форма добавления (только для админа) -->
    {% if current_user.role == 'admin' %}
    <div style="margin: 20px 0; padding: 15px; border: 1px solid #ccc; background: #f9f9f9;">
        <h3>Добавить новый товар</h3>
        <form method="POST" action="/storage">
            <input type="text" name="name" placeholder="Название" required>
            <input type="number" name="count" placeholder="Количество" required>
            <select name="type_of_product">
                <option value="продукт">Продукт</option>
                <option value="блюдо">Блюдо</option>
            </select>
            <button type="submit">Добавить</button>
        </form>
    </div>
    {% endif %}
    
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Количество</th>
                <th>Тип</th>
                {% if current_user.role == 'admin' %}
                <th>Действия</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for item in storage_items %}
            <tr>
                <td>{{ item.id }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.count }}</td>
                <td>{{ item.type_of_product }}</td>
                {% if current_user.role == 'admin' %}
                <td>
                    <a href="/storage/edit/{{ item.id }}">Ред.</a> | 
                    <a href="/storage/delete/{{ item.id }}" onclick="return confirm('Удалить?');" style="color: red;">Удал.</a>
                </td>
                {% endif %}
            </tr>
            {% else %}
            <tr>
                <td colspan="{% if current_user.role == 'admin' %}5{% else %}4{% endif %}">Склад пуст.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
